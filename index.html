<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fixed Supply Digital Money - Demo</title>
<style>
    body {
        font-family: "Roboto", sans-serif;
        background: linear-gradient(135deg, #0a0f2d, #091426);
        color: #e8ecf3;
        margin: 0;
        padding: 20px;
        display: flex;
        justify-content: center;
    }
    .container {
        width: 420px;
        background: #111a35;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 0 25px #00000070;
        animation: fadeIn .7s;
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to   { opacity: 1; transform: translateY(0);   }
    }
    h2 {
        text-align: center;
        margin-bottom: 10px;
        color: #4fc3f7;
        font-size: 24px;
    }
    input, button {
        width: 100%;
        padding: 10px;
        margin: 6px 0;
        border-radius: 7px;
        border: none;
    }
    input {
        background: #1a254d;
        color: #fff;
        border: 1px solid #26356a;
    }
    button {
        background: #4fc3f7;
        color: #000;
        font-weight: bold;
        cursor: pointer;
        transition: .2s;
    }
    button:hover {
        opacity: .8;
    }
    .box {
        background: #0f1733;
        padding: 12px;
        border-radius: 10px;
        margin-top: 10px;
        border: 1px solid #1d2a52;
    }
    .ledger-item {
        background: #18224a;
        padding: 10px;
        border-radius: 8px;
        margin: 8px 0;
        border-left: 4px solid #4fc3f7;
        font-size: 13px;
    }
</style>
</head>
<body>

<div class="container">
    <h2>Digital Money (Fixed Supply)</h2>

    <h3>Check Balance</h3>
    <input id="wallet" placeholder="Wallet ID">
    <button onclick="checkBalance()">Check</button>
    <div id="balanceBox" class="box"></div>

    <h3>Send Money</h3>
    <input id="from" placeholder="From Wallet">
    <input id="to" placeholder="To Wallet">
    <input id="amount" type="number" placeholder="Amount">
    <button onclick="sendMoney()">Send</button>

    <h3>Ledger (Hashed Blocks)</h3>
    <div id="ledger" class="box"></div>
</div>

<script>
// ---------- SUPPLY GO'AN ----------
const TOTAL_SUPPLY = 1000000;

// Initialize supply only once
if (!localStorage.getItem("GENESIS_DONE")) {
    localStorage.setItem("GENESIS_DONE", "YES");
    localStorage.setItem("TOTAL_SUPPLY", TOTAL_SUPPLY);

    // genesis balance
    localStorage.setItem("balances", JSON.stringify({ "SYSTEM": TOTAL_SUPPLY }));

    // genesis block
    const genesisBlock = {
        index: 0,
        from: "GENESIS",
        to: "SYSTEM",
        amount: TOTAL_SUPPLY,
        prevHash: "0",
        time: new Date().toLocaleString()
    };
    genesisBlock.hash = sha256(JSON.stringify(genesisBlock));

    localStorage.setItem("ledger", JSON.stringify([genesisBlock]));
}

// ---------- LOAD DATA ----------
let balances = JSON.parse(localStorage.getItem("balances"));
let ledger = JSON.parse(localStorage.getItem("ledger"));

// ---------- SHA-256 FUNCTION ----------
async function sha256(msg) {
    const msgBuffer = new TextEncoder().encode(msg);
    const hashBuffer = await crypto.subtle.digest("SHA-256", msgBuffer);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    return hashArray.map(b => b.toString(16).padStart(2, "0")).join("");
}

// ---------- SEND MONEY ----------
async function sendMoney() {
    const from = document.getElementById("from").value.trim();
    const to = document.getElementById("to").value.trim();
    const amount = Number(document.getElementById("amount").value);

    if (!from || !to || !amount) return alert("Fill all fields");

    if (!balances[from]) balances[from] = 0;
    if (!balances[to]) balances[to] = 0;

    if (balances[from] < amount)
        return alert("Insufficient balance!");

    balances[from] -= amount;
    balances[to] += amount;

    // create block
    const prev = ledger[ledger.length - 1];
    const newBlock = {
        index: ledger.length,
        from, to, amount,
        prevHash: prev.hash,
        time: new Date().toLocaleString()
    };
    newBlock.hash = await sha256(JSON.stringify(newBlock));

    ledger.push(newBlock);

    // save
    localStorage.setItem("balances", JSON.stringify(balances));
    localStorage.setItem("ledger", JSON.stringify(ledger));

    alert("Transaction successful!");
    renderLedger();
}

// ---------- CHECK BALANCE ----------
function checkBalance() {
    const wallet = document.getElementById("wallet").value.trim();
    if (!wallet) return alert("Enter wallet ID");

    const bal = balances[wallet] || 0;
    document.getElementById("balanceBox").innerHTML =
        `<strong>Balance:</strong> ${bal}`;
}

// ---------- RENDER LEDGER ----------
function renderLedger() {
    const box = document.getElementById("ledger");
    box.innerHTML = "";

    ledger.slice().reverse().forEach(block => {
        box.innerHTML += `
            <div class="ledger-item">
                <strong>Block #${block.index}</strong><br>
                From: ${block.from} â†’ To: ${block.to}<br>
                Amount: ${block.amount}<br>
                <small>Time: ${block.time}</small><br>
                <small>PrevHash: ${block.prevHash.slice(0,20)}...</small><br>
                <small>Hash: ${block.hash.slice(0,20)}...</small>
            </div>
        `;
    });
}

renderLedger();
</script>

</body>
</html>
